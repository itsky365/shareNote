# 正则表达式

在OpenResty中，同时存在两套正则表达式规范： Lua 语言的规范和Nginx的规范，即使您对 Lua 语言中的规范非常熟悉，我们仍不建议使用 Lua 中的正则表达式。一是因为 Lua 中正则表达式的性能并不如 Nginx 中的正则表达式优秀；二是 Lua 中的正则表达式并不符合 POSIX 规范，而 Nginx 中实现的是标准的 POSIX 规范，后者明显更具备通用性。

Lua 中的正则表达式与Nginx中的正则表达式相比，有5%-15%的性能损失，而且Lua将表达式编译成Pattern之后，并不会将Pattern缓存，而是每此使用都重新编译一遍，潜在地降低了性能。 Nginx 中的正则表达式可以通过参数缓存编译过后的Pattern，不会有类似的性能损失。

Lua 中正则表达式语法上最大的区别，Lua 使用 '%' 来进行转义，而其他语言的正则表达式使用 '\' 符号来进行转义。其次， Lua 中并不使用 '?' 来表示非贪婪匹配，而是定义了不同的字符来表示是否是贪婪匹配。定义如下：

符号	匹配次数	匹配模式

|---|---|---|
| + | 匹配前一字符 1 次或多次 | 非贪婪 |
| * | 匹配前一字符 0 次或多次 | 贪婪 |
| - | 匹配前一字符 0 次或多次 | 非贪婪 |
| ? | 匹配前一字符 0 次或1次 | 仅用于此，不用于标识是否贪婪 |


|---|---|
| 符号 | 匹配模式 |
| . | 任意字符 |
| %a | 字母 |
| %c | 控制字符 |
| %d | 数字 |
| %l | 小写字母 |
| %p | 标点字符 |
| %s | 空白符 |
| %u | 大写字母 |
| %w | 字母和数字 |
| %x | 十六进制数字 |
| %z | 代表 0 的字符 |

